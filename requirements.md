# üìù Requirements: Synthetic Memory & Context

## 1. Memory Artifacts
The system must persist the following artifacts in the **User's Project Directory** (e.g., `<project_root>/syntheticMemory/features/<feature>/<ticket>/`).

### `summary.json`
Must include semantic summaries to aid future context retrieval:
- **`change_required`**: A concise (1-2 sentence) summary of the original task/requirements.
    - *Source*: Generated by the Agent at the end of the session.
- **`changes_made`**: A concise (1-2 sentence) summary of the actual implementation details.
    - *Source*: Generated by the Agent at the end of the session.
- **`pr_url`**: The URL of the created Pull Request.
    - *Source*: Provided by Agent or Developer via `finalize_session`.

### `agent_run.json`
Must include operational data:
- **`full_prompt`**: The exact prompt text generated and used for the session.
    - *Purpose*: Allows re-evaluation and PESS scoring analysis.

## 2. Agent Workflow
- The **Agent** (e.g., Cursor, Windsurf) is responsible for generating the summaries.
- The **Prompt** must explicitly instruct the Agent to:
    1. Analyze the original request (`change_required`).
    2. Summarize its actions (`changes_made`).
    3. Call `finalize_session` with these fields.
- The **MCP Server** MUST NOT make independent LLM calls for summary generation (to maintain portability and avoid API key requirements on the server side).

## 3. Data Persistence & Location
- **Project-Scoped Memory**: Synthetic memory files MUST be written to the `project_root` provided during the `prepare_agent_task` call.
- **Session Continuity**: The `project_root` context must be preserved across the session lifecycle (from `prepare` to `finalize`) to ensure the final write occurs in the correct location.
- **Default Fallback**: If no project root is provided, default to the Agent's configured root, but production usage should always specify a project root.

## 4. Fallback Behaviors
- If `changes_made` is not provided by the agent, the system MUST fallback to using the `feedback` field to ensure *some* record of the action is preserved.
- If `change_required` is missing, the system preserves the field as null (or legacy fallback if implemented), relying on the prompt to enforce agent compliance.
